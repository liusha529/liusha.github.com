<!DOCTYPE html>
<html>
  <head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" >
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0">
	<title>Node和MongoDB数据库打交道</title>
	<meta name="description" content="云飞的个人博客、web、后端、javascript、css、html、H5、CSS3、web工程师、gulp、jekyll、git">
	<meta name="keywords" content="web、后端、webapp、个人博客、技术博客、github博客、javascript、css、html、H5、CSS3、web工程师、gulp" />
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="msapplication-tap-highlight" content="no">
	<meta name="author" contect="maoxiaoke, maoxiaoke@outlook.com">
	<meta name="robots" content="index,follow">
	<link rel="shortcut icon" href="/styles/images/favicon.png">
	<link rel="icon" href="/styles/images/favicon.png">
	<link rel="stylesheet" href="/styles/css/index.css">
	<link rel="stylesheet" href="/styles/css/fontawesome/css/font-awesome.min.css">
	<link rel="canonical" href="http://localhost:4000">
	<!--[if lte IE 9]>
    	<script src="http://apps.bdimg.com/libs/html5shiv/3.7/html5shiv.min.js"></script>
  	<![endif]-->
	<!--[if lt IE 9]>
    	<script>window.location.href='/upgrade-your-browser.html';</script>
    <![endif]-->
	<script>
		var _hmt = _hmt || [];
		(function() {
  			var hm = document.createElement("script");
  			hm.src = "https://hm.baidu.com/hm.js?40ab350f7c60a488b8e8093960c0faf2";
  			var s = document.getElementsByTagName("script")[0]; 
  			s.parentNode.insertBefore(hm, s);
		})();
	</script>
</head>
  <body class="index">
    <header class="navbar navbar-inverse navbar-fixed-top docs-nav" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand">
        <img src="/styles/images/logo.png" alt="小可嗒嗒的个人博客">
      </a>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">
        <li></li>
        <li>
          <a href="/">首页</a>
        </li>
        <li>
          <a href="/categories/">博文分类</a>
        </li>
        <li>
          <a href="/tag">标签目录</a>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">

        <li><a rel="nofollow" href="/about">关于我</a></li>



        <!--<li><a rel="nofollow" target="_blank" href="https://liusha529.github.io/">关于我</a></li>-->

      </ul>
    </nav>
  </div>
</header>
    <div class="docs-header pa" id="content">
    <canvas id="mycanvas">你的浏览器不支持canvas</canvas>
    <div class="container" >
  	
        <!--
		    <h1>Node和MongoDB数据库打交道</h1>
		    <p>Post on Jun 09, 2017 by <a href="/about">LiuSha</a></p>
		-->
        <h1>我们笑着说再见，却深知再见遥遥无期。</h1>
    
  </div>
</div>
    
      
<div class="banner">
  <div class="container lh30">
  	
    	<a href="/categories/#研究生涯-ref">研究生涯</a>	/
    	<a href="/tag/#Node-ref">Node</a>
    
      <div id="search-container" class="pull-right">
          <input type="text" id="search-input" placeholder=" 试试直接搜索吧...">
          <label class="searchIcon glyphicon glyphicon-search" for="search-input"></label>
          <ul id="results-container"></ul>
      </div>
  </div>
</div>

    
    <div class="container docs-container">
  <div class="row">
    <div class="col-md-3">
      <div class="sidebar hidden-print" role="complementary">
        <div id="navigation">
  <h1>目录</h1>
  <ul class="nav sidenav">
<!--
    
      
      
      
      

      
        <li><a href="#year_2018">2018</a>
          <ul class="nav">
            <li><a href="#month_2018_January">January</a></li>
      

      
        
            </ul>
          </li>
          <li><a href="#year_2017">2017</a>
            <ul class="nav">
              <li><a href="#month_2017_October">October</a></li>
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2017_August">August</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2017_July">July</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2017_June">June</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2017_May">May</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2017_April">April</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2017_March">March</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2017_February">February</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2017_January">January</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
        
            </ul>
          </li>
          <li><a href="#year_2015">2015</a>
            <ul class="nav">
              <li><a href="#month_2015_February">February</a></li>
        
      
    
      
      
      
      

      

      
            </ul>
          </li>
      
    
-->
  </ul>
</div> 
      </div>
    </div>
    <div class="col-md-9" role="main">
      <div class="panel docs-content">
        <div class="wrapper">
            <header class="post-header">
              <h1 class="post-title">Node和MongoDB数据库打交道</h1>
              <!--
                <p class="post-meta">Jun 9, 2017</p>
              -->
              <div class="meta">Date： <span class="postdate">Jun 09, 2017</span> Author： <a target="_blank" href="http://localhost:4000">LiuSha</a></div>
              <br />
              <blockquote><p>本文章采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh"> 知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议 </a>进行许可。转载请注明来自<a href="http://xiaokedada.com">小可嗒嗒的博客</a></p></blockquote>
            </header>
            <article class="post-content">
              <ul id="markdown-toc">
  <li><a href="#mongodb的安装和资源" id="markdown-toc-mongodb的安装和资源">MongoDB的安装和资源</a></li>
  <li><a href="#javascript-shell" id="markdown-toc-javascript-shell">JavaScript Shell</a>    <ul>
      <li><a href="#启动shell" id="markdown-toc-启动shell">启动shell</a></li>
      <li><a href="#创建数据库集合和文档" id="markdown-toc-创建数据库集合和文档">创建数据库、集合和文档</a></li>
      <li><a href="#插入和查询" id="markdown-toc-插入和查询">插入和查询</a></li>
      <li><a href="#更新文档" id="markdown-toc-更新文档">更新文档</a>        <ul>
          <li><a href="#第一种更新一个或多个文档" id="markdown-toc-第一种更新一个或多个文档">第一种，更新一个或多个文档</a></li>
          <li><a href="#第二种直接替换文档" id="markdown-toc-第二种直接替换文档">第二种，直接替换文档</a></li>
          <li><a href="#更新复杂数据" id="markdown-toc-更新复杂数据">更新复杂数据</a></li>
        </ul>
      </li>
      <li><a href="#删除数据" id="markdown-toc-删除数据">删除数据</a></li>
    </ul>
  </li>
</ul>

<p>数据库有<em>关系型数据库</em>(RDBMS)，关系型数据库相对比较高端，也有很多种，但开源的我们一般都使用<code class="highlighter-rouge">MySQL</code>或者<code class="highlighter-rouge">PostgreSQL</code>。</p>

<ul>
  <li><code class="highlighter-rouge">MySQL</code>一般会使用比较流行的<code class="highlighter-rouge">Felix Geisendorfer</code>的<code class="highlighter-rouge">mysql</code>模块</li>
  <li><code class="highlighter-rouge">PostgreSQL</code>一般使用<code class="highlighter-rouge">Brian Carlson</code>的<code class="highlighter-rouge">node-postgres</code>模块</li>
</ul>

<p>非关系型数据库在最近几年隐隐有复兴之势，他们称为<code class="highlighter-rouge">NoSQL</code>数据库，即：Not Only SQL。可以这么说，关系型数据库为了可靠性牺牲了性能，而很多<code class="highlighter-rouge">NoSQL</code>数据库把性能放在了第一位。两个非常流行的<code class="highlighter-rouge">NoSQL</code>数据库，就是<code class="highlighter-rouge">Redis</code>和<code class="highlighter-rouge">MongoDB</code>。</p>

<ul>
  <li><code class="highlighter-rouge">Redis</code>一般使用<code class="highlighter-rouge">Matt Ranney</code>的<code class="highlighter-rouge">redis</code>模块</li>
  <li><code class="highlighter-rouge">MongoDB</code>最成熟最活跃的是<code class="highlighter-rouge">Charistian Amor Kvalheim</code>的<code class="highlighter-rouge">mongodb</code>模块</li>
</ul>

<!-- more -->

<h2 id="mongodb的安装和资源">MongoDB的安装和资源</h2>

<p>对于<code class="highlighter-rouge">Windows</code>下的安装我觉得还是很烦的，这个平台对开发者真的不太友好呀。我觉得最好还是查看官方的安装教程: <a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-windows/">MongoDB Window平台安装</a>，网上有很多安装教程，很多我都觉得是一知半解，就把教程搬上来，还是不太建议。</p>

<p><strong>警报</strong>: <code class="highlighter-rouge">Windows</code>平台使用<code class="highlighter-rouge">CMD</code>，一定要<strong>以管理员身份运行</strong>，否则会有访问错误。</p>

<p>有时候我们可以利用<code class="highlighter-rouge">services.msc</code>来查看<code class="highlighter-rouge">windows</code>服务。若要开启<code class="highlighter-rouge">MongoDB</code>服务器：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>λ net start MongoDB
MongoDB 服务正在启动 <span class="nb">.</span>
MongoDB 服务已经启动成功。
</code></pre></div></div>

<p>若要停止服务器:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>λ net stop MongoDB
MongoDB 服务正在停止.
MongoDB 服务已成功停止。
</code></pre></div></div>

<p>开启<code class="highlighter-rouge">MongoDB</code>服务器之后，我们可以使用<code class="highlighter-rouge">mongo</code>来启动<code class="highlighter-rouge">MongoDB shell</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>λ mongo
MongoDB shell version v3.4.4
connecting to: mongodb://127.0.0.1:27017
MongoDB server version: 3.4.4
Welcome to the MongoDB shell.
For interactive <span class="nb">help</span>, <span class="nb">type</span> <span class="s2">"help"</span><span class="nb">.</span>
For more comprehensive documentation, see
        http://docs.mongodb.org/
Questions? Try the support group
        http://groups.google.com/group/mongodb-user
Server has startup warnings:
2017-06-09T16:57:57.010+0800 I CONTROL  <span class="o">[</span>initandlisten]
2017-06-09T16:57:57.010+0800 I CONTROL  <span class="o">[</span>initandlisten] <span class="k">**</span> WARNING: Access control is not enabled <span class="k">for </span>the database.
2017-06-09T16:57:57.010+0800 I CONTROL  <span class="o">[</span>initandlisten] <span class="k">**</span>          Read and write access to data and configuration is unrestricted.
2017-06-09T16:57:57.010+0800 I CONTROL  <span class="o">[</span>initandlisten]
<span class="o">&gt;</span> 
</code></pre></div></div>

<p>资源：</p>

<ul>
  <li><a href="https://university.mongodb.com/">MongoDB University</a></li>
  <li><a href="https://courses.edx.org/courses/course-v1:MongoDBx+M101x+2T2016/info">edX的MongoDB课程</a></li>
</ul>

<hr />

<h2 id="javascript-shell">JavaScript Shell</h2>

<p><code class="highlighter-rouge">MongoDB</code>命令行工具是一个基于<code class="highlighter-rouge">JavaScript</code>的数据库操作和管理工具。</p>

<h3 id="启动shell">启动shell</h3>

<p>首先要开启<code class="highlighter-rouge">MongoDB</code>服务器，然后运行<code class="highlighter-rouge">mongo</code>执行文件(<code class="highlighter-rouge">mongo.exe</code>在安装目录的<code class="highlighter-rouge">bin</code>文件夹下)。</p>

<blockquote>
  <p>在<code class="highlighter-rouge">Windows</code>系统下，你可以将<code class="highlighter-rouge">mongo</code>加入系统环境变量。比如，我的安装目录是<code class="highlighter-rouge">F:\Program Files\MongoDB\Server\3.4\bin</code>，所以将此目录加入系统环境变量的<code class="highlighter-rouge">Path</code>变量中。</p>
</blockquote>

<p>运行<code class="highlighter-rouge">MongoDB Shell</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>λ mongo
MongoDB shell version v3.4.4
connecting to: mongodb://127.0.0.1:27017
MongoDB server version: 3.4.4
Server has startup warnings:
2017-06-14T21:53:34.579+0800 I CONTROL  <span class="o">[</span>initandlisten]
2017-06-14T21:53:34.579+0800 I CONTROL  <span class="o">[</span>initandlisten] <span class="k">**</span> WARNING: Access control is not enabled <span class="k">for </span>the database.
2017-06-14T21:53:34.579+0800 I CONTROL  <span class="o">[</span>initandlisten] <span class="k">**</span>          Read and write access to data and configuration is unrestricted.
2017-06-14T21:53:34.579+0800 I CONTROL  <span class="o">[</span>initandlisten]
</code></pre></div></div>

<h3 id="创建数据库集合和文档">创建数据库、集合和文档</h3>

<p>创建数据库。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nx">use</span> <span class="nx">tutorial</span>
<span class="nx">switched</span> <span class="nx">to</span> <span class="nx">db</span> <span class="nx">tutorial</span>
</code></pre></div></div>

<p>注意： 这个命令只是切换到<code class="highlighter-rouge">tutorial</code>数据库而不需要显示创建它。只有在第一次插入数据库和集合时才会创建，这也符合<code class="highlighter-rouge">MongoDB</code>动态操作数据的模式。</p>

<p>创建集合(collection)和文档。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="na">username</span><span class="p">:</span><span class="s2">"mao"</span><span class="p">})</span>
<span class="nx">WriteResult</span><span class="p">({</span> <span class="s2">"nInserted"</span> <span class="p">:</span> <span class="mi">1</span> <span class="p">})</span>
</code></pre></div></div>

<p>这里，<code class="highlighter-rouge">users</code>就是一个集合，你可以使用<code class="highlighter-rouge">show collections</code>命令来查看。同时，也可以使用<code class="highlighter-rouge">show dbs</code>来查看所有的数据库。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> show collections
numbers
<span class="nb">users</span>
<span class="o">&gt;</span> show dbs
admin     0.000GB
<span class="nb">local     </span>0.000GB
tutorial  0.000GB
</code></pre></div></div>

<blockquote>
  <p><code class="highlighter-rouge">tutorial</code>是我们创建的数据库。<code class="highlighter-rouge">admin</code>和<code class="highlighter-rouge">local</code>是系统默认的。</p>
</blockquote>

<h3 id="插入和查询">插入和查询</h3>

<p><code class="highlighter-rouge">db.users.insert({username:"mao"})</code>就将我的姓名插入了一个文档，如果插入成功，也成功保存了第一个文档。</p>

<p>查看这个文档：</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">find</span><span class="p">()</span>
<span class="p">{</span> <span class="s2">"_id"</span> <span class="p">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">"5941405661a0c8c10ed875ad"</span><span class="p">),</span> <span class="s2">"username"</span> <span class="p">:</span> <span class="s2">"mao"</span> <span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>有时候为了更好看的，可以使用<code class="highlighter-rouge">find().pretty()</code></p>
</blockquote>

<p><code class="highlighter-rouge">_id</code>字段是文档的主键。<code class="highlighter-rouge">ObjectId</code>是<code class="highlighter-rouge">MongoDB</code>默认的，表示系统自己创建的。</p>

<p>在多个文档中，你可以向<code class="highlighter-rouge">find()</code>传入参数来传递查询条件。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="na">username</span><span class="p">:</span><span class="s2">"timi"</span><span class="p">})</span>
<span class="nx">WriteResult</span><span class="p">({</span> <span class="s2">"nInserted"</span> <span class="p">:</span> <span class="mi">1</span> <span class="p">})</span>
<span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">count</span><span class="p">()</span>
<span class="mi">2</span>
<span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">find</span><span class="p">()</span>
<span class="p">{</span> <span class="s2">"_id"</span> <span class="p">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">"5941405661a0c8c10ed875ad"</span><span class="p">),</span> <span class="s2">"username"</span> <span class="p">:</span> <span class="s2">"mao"</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">"_id"</span> <span class="p">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">"5941416961a0c8c10ed875ae"</span><span class="p">),</span> <span class="s2">"username"</span> <span class="p">:</span> <span class="s2">"timi"</span> <span class="p">}</span>
<span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="na">username</span><span class="p">:</span><span class="s2">"timi"</span><span class="p">})</span>
<span class="p">{</span> <span class="s2">"_id"</span> <span class="p">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">"5941416961a0c8c10ed875ae"</span><span class="p">),</span> <span class="s2">"username"</span> <span class="p">:</span> <span class="s2">"timi"</span> <span class="p">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">count()</code>函数可以计算集合中的文档数。</p>

<p>查询多个字段。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="na">username</span><span class="p">:</span><span class="s2">"timi"</span><span class="p">,</span><span class="na">_id</span><span class="p">:</span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">"5941416961a0c8c10ed875ae"</span><span class="p">)})</span>
<span class="p">{</span> <span class="s2">"_id"</span> <span class="p">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">"5941416961a0c8c10ed875ae"</span><span class="p">),</span> <span class="s2">"username"</span> <span class="p">:</span> <span class="s2">"timi"</span> <span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>实际上，这段命令隐式创建了<code class="highlighter-rouge">AND</code>语句。和这条语句是等价的<code class="highlighter-rouge">&gt; db.users.find({$and: [{username:"timi"},{_id:ObjectId("5941416961a0c8c10ed875ae"})]})</code></p>
</blockquote>

<p>如果要使用<code class="highlighter-rouge">OR</code>查询文档，只需使用<code class="highlighter-rouge">$or</code>替换。</p>

<h3 id="更新文档">更新文档</h3>

<p>所有的更新操作至少需要2个参数。第一个指定要更新的文档，第二个定义如何修改此文档。</p>

<h4 id="第一种更新一个或多个文档">第一种，更新一个或多个文档</h4>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="na">username</span><span class="p">:</span><span class="s2">"timi"</span><span class="p">},{</span><span class="na">$set</span><span class="p">:{</span><span class="na">country</span><span class="p">:</span><span class="s2">"China"</span><span class="p">}})</span>
<span class="nx">WriteResult</span><span class="p">({</span> <span class="s2">"nMatched"</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"nUpserted"</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"nModified"</span> <span class="p">:</span> <span class="mi">1</span> <span class="p">})</span>
<span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">find</span><span class="p">()</span>
<span class="p">{</span> <span class="s2">"_id"</span> <span class="p">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">"5941405661a0c8c10ed875ad"</span><span class="p">),</span> <span class="s2">"username"</span> <span class="p">:</span> <span class="s2">"mao"</span> <span class="p">}</span>
<span class="p">{</span> <span class="s2">"_id"</span> <span class="p">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">"5941416961a0c8c10ed875ae"</span><span class="p">),</span> <span class="s2">"username"</span> <span class="p">:</span> <span class="s2">"timi"</span><span class="p">,</span> <span class="s2">"country"</span> <span class="p">:</span> <span class="s2">"China"</span> <span class="p">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">update</code>的第一个参数是查找一个用户名为<code class="highlighter-rouge">timi</code>的文档，如何将<code class="highlighter-rouge">country</code>属性设置为<code class="highlighter-rouge">China</code>。使用<code class="highlighter-rouge">$set</code>操作符。</p>

<p>如果不想要的字段，使用<code class="highlighter-rouge">$unset</code>操作符删除即可。</p>

<h4 id="第二种直接替换文档">第二种，直接替换文档</h4>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">update</span> <span class="p">({</span><span class="na">username</span><span class="p">:</span><span class="s2">"timi"</span><span class="p">},{</span><span class="na">country</span><span class="p">:</span><span class="s2">"Chia"</span><span class="p">})</span>
<span class="nx">WriteResult</span><span class="p">({</span><span class="s2">"nMatched"</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span><span class="s2">"nUpserted"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">"nModified"</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="更新复杂数据">更新复杂数据</h4>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">update</span> <span class="p">({</span><span class="na">username</span><span class="p">:</span><span class="s2">"timi"</span><span class="p">},</span>
<span class="p">...</span> <span class="p">{</span>
<span class="p">...</span> <span class="nx">$set</span><span class="p">:{</span>
<span class="p">...</span> <span class="nx">favorites</span><span class="p">:{</span>
<span class="p">...</span> <span class="nx">cities</span><span class="p">:[</span><span class="s2">"Nanking"</span><span class="p">,</span> <span class="s2">"NUAA"</span><span class="p">],</span>
<span class="p">...</span> <span class="nx">movies</span><span class="p">:[</span><span class="s2">"For a Few dollars"</span><span class="p">,</span><span class="s2">"The String"</span><span class="p">]}</span>
<span class="p">...</span> <span class="p">}</span>
<span class="p">...</span> <span class="p">})</span>
<span class="nx">WriteResult</span><span class="p">({</span> <span class="s2">"nMatched"</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"nUpserted"</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"nModified"</span> <span class="p">:</span> <span class="mi">1</span> <span class="p">})</span>
</code></pre></div></div>

<h3 id="删除数据">删除数据</h3>

<ol>
  <li>清空集合中的所有文档</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> db.users.remove<span class="o">()</span>
</code></pre></div></div>

<ol>
  <li>删除某些文档</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> db.users.remove <span class="o">({</span>country:<span class="s2">"China"</span><span class="o">})</span>
WriteResult<span class="o">({</span><span class="s2">"nRemoved: 1"</span><span class="o">}</span>
</code></pre></div></div>

<p>这个操作删除了所有<code class="highlighter-rouge">country</code>为<code class="highlighter-rouge">China</code>的文档。</p>

<ol>
  <li>删除结合及其附带的索引，使用<code class="highlighter-rouge">drop</code>方法</li>
</ol>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nx">db</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">drop</span><span class="p">()</span>
</code></pre></div></div>

            </article>
          <hr>
          <blockquote><p>对于本文内容有问题或建议的小伙伴，欢迎在文章底部留言交流讨论。</p></blockquote>
        </div>
      </div>
      <!--comment-->
      <!--code for 网易云跟帖
      <div class="panel docs-content">
        <article class="post-content">
          <div class="wrapper">
            <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
            <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
            <script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script>
            <script>
            var cloudTieConfig = {
            url: document.location.href, 
            sourceId: "",
            productKey: "b6d55f09637f497389b80bafc11aada1",
            target: "cloud-tie-wrapper"
            };
            var yunManualLoad = true;
            Tie.loader("aHR0cHM6Ly9hcGkuZ2VudGllLjE2My5jb20vcGMvbGl2ZXNjcmlwdC5odG1s", true);
            </script>
          </div>
        </article>
      </div> -->
      <!--Gitment-->
      <div id="container"></div>
      <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
      <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
      <script>
        var gitment = new Gitment({
          id: window.location.pathname, 
          owner: 'liusha529',
          repo: 'liusha529.github.io',
          oauth: {
          client_id: 'b389957bf0758092f3eb',
          client_secret: 'b84e22f17551d822d114d1d1d06244bc8d5fc987',
          },
        })
        gitment.render('container')
      </script>
      
    </div>
  </div>
</div>


    <footer class="footer" role="contentinfo">
	<!--不蒜子pv/uv统计-->
	<div class="post-meta">
            <p>Total <span id="busuanzi_value_site_pv"></span> views，您是本站的第<span id="busuanzi_value_site_uv"></span>个小伙伴，<span id="busuanzi_value_page_pv"></span> Hits</p><br/>
    </div>
	<div class="container">
		<p class="copyright">Copyright © 2017   <a href="https://github.com/maoxiaoke/maoxiaoke.github.io" target="_blank"><code>M/J.</code></a> All rights reserved. </p>
		<p>Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a>， Data by <a href="https://tongji.baidu.com/web/23811489/overview/index" target="_blank">Bai Du</a>.</p>
	</div>
	<ul id="gotop"><li><span>TOP</span></li></ul>
</footer>
<script src="http://apps.bdimg.com/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="http://apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="/styles/js/function.min.js"></script>
<script src="/styles/js/lessismore.js"></script>
<script src="/styles/js/application.min.js"></script>
  </body>
</html>
